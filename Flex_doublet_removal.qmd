---
title: "Untitled"
format: html
---

# FLEX lung doublet removal using ScDblFinder

```{r}
library(anndataR)
library(SingleCellExperiment)
library(scDblFinder)
```


```{r}
adata <- read_h5ad("flex_adata_combined_pre_qc.h5ad", as = "SingleCellExperiment")
adata
```

```{r}
assay(adata, "counts") <- assay(adata, "X")
adata <- scDblFinder(adata, samples = "sample_id", dbr.sd = 1)
```

```{r}
colData(adata)$doublet_score <- colData(adata)$scDblFinder.score
colData(adata)$doublet_class <- colData(adata)$scDblFinder.class
```

```{r}
table(adata$doublet_class, adata$sample_id)
adata <- as_AnnData(adata)
adata
```
```{r}
write_h5ad(adata, path ="flex_data_doublets_identified.h5ad", mode = "w")
```